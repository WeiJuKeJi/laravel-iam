{
  "openapi": "3.0.3",
  "info": {
    "title": "权限管理 API",
    "description": "权限管理相关接口，包括权限的创建、查询、更新和删除功能",
    "version": "1.0.0"
  },
  "paths": {
    "/iam/permissions": {
      "get": {
        "tags": ["Iam/Permission"],
        "summary": "获取权限列表",
        "description": "分页获取权限列表，支持按关键词、守卫、分组筛选\n\n**测试用例：**\n1. 默认分页查询（page=1, per_page=50）\n2. 按关键词搜索（keywords=users）\n3. 按守卫筛选（guard_name=sanctum）\n4. 按分组筛选（group=device.Kiosks）",
        "operationId": "getPermissions",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "Accept", "in": "header", "required": true, "schema": { "type": "string" }, "example": "application/json" },
          { "name": "keywords", "in": "query", "description": "关键词搜索（权限名称/显示名称/分组）", "schema": { "type": "string" } },
          { "name": "guard_name", "in": "query", "description": "守卫筛选", "schema": { "type": "string" } },
          { "name": "group", "in": "query", "description": "权限分组 key，如 device.Kiosks", "schema": { "type": "string" } },
          { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 } },
          { "name": "per_page", "in": "query", "schema": { "type": "integer", "default": 50, "minimum": 1, "maximum": 100 } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "example": { "code": 200, "msg": "success", "data": { "list": [{ "id": 1, "name": "device.kiosks.view", "display_name": "device.Kiosks.查看", "group": "device.Kiosks", "guard_name": "sanctum", "created_at": "2025-11-14T00:00:00.000Z" }], "total": 1 } }
              }
            }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      },
      "post": {
        "tags": ["Iam/Permission"],
        "summary": "创建权限",
        "description": "创建新权限\n\n**测试用例：**\n1. 创建查看权限\n2. 创建管理权限",
        "operationId": "createPermission",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "Accept", "in": "header", "required": true, "schema": { "type": "string" }, "example": "application/json" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "examples": {
                "查看权限": {
                  "summary": "创建查看权限",
                  "value": { "name": "iam.users.view", "display_name": "iam.Users.查看", "group": "iam.Users" }
                },
                "管理权限": {
                  "summary": "创建管理权限",
                  "value": { "name": "iam.users.manage", "display_name": "iam.Users.管理", "group": "iam.Users" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "创建成功",
            "content": {
              "application/json": {
                "example": { "code": 200, "msg": "权限创建成功", "data": { "id": 1, "name": "iam.users.view", "display_name": "iam.Users.查看", "group": "iam.Users", "guard_name": "sanctum" } }
              }
            }
          },
          "422": { "$ref": "#/components/responses/ValidationError" }
        }
      }
    },
    "/iam/permissions/groups": {
      "get": {
        "tags": ["Iam/Permission"],
        "summary": "获取权限分组树",
        "description": "获取权限分组树，用于左树右表\n\n**测试用例：**\n1. 获取分组树",
        "operationId": "getPermissionGroups",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "Accept", "in": "header", "required": true, "schema": { "type": "string" }, "example": "application/json" }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "example": { "code": 200, "msg": "success", "data": { "tree": [{ "key": "device", "label": "Device 设备管理", "count": 13, "children": [{ "key": "device.Kiosks", "label": "Kiosks", "count": 5, "module": "device" }] }], "total": 1 } }
              }
            }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      }
    },
    "/iam/permissions/{id}": {
      "get": {
        "tags": ["Iam/Permission"],
        "summary": "查看权限详情",
        "description": "查看指定权限的详细信息",
        "operationId": "getPermission",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "Accept", "in": "header", "required": true, "schema": { "type": "string" }, "example": "application/json" },
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "example": { "code": 200, "msg": "success", "data": { "id": 1, "name": "iam.users.view", "display_name": "iam.Users.查看", "group": "iam.Users", "guard_name": "sanctum", "created_at": "2025-11-14T00:00:00.000Z" } }
              }
            }
          },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "put": {
        "tags": ["Iam/Permission"],
        "summary": "更新权限",
        "description": "更新权限信息，所有字段均为可选\n\n**测试用例：**\n1. 更新显示名称\n2. 更新分组",
        "operationId": "updatePermission",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "Accept", "in": "header", "required": true, "schema": { "type": "string" }, "example": "application/json" },
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "examples": {
                "更新名称": {
                  "summary": "更新显示名称",
                  "value": { "display_name": "iam.Users.查看" }
                },
                "更新分组": {
                  "summary": "更新权限分组",
                  "value": { "group": "iam.Users" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功",
            "content": {
              "application/json": {
                "example": { "code": 200, "msg": "权限更新成功", "data": { "id": 1, "name": "iam.users.view", "display_name": "iam.Users.查看", "group": "iam.Users" } }
              }
            }
          },
          "422": { "$ref": "#/components/responses/ValidationError" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "delete": {
        "tags": ["Iam/Permission"],
        "summary": "删除权限",
        "description": "删除指定权限",
        "operationId": "deletePermission",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "Accept", "in": "header", "required": true, "schema": { "type": "string" }, "example": "application/json" },
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "删除成功",
            "content": {
              "application/json": {
                "example": { "code": 200, "msg": "权限删除成功", "data": null }
              }
            }
          },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "Token"
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "未授权",
        "content": {
          "application/json": {
            "example": { "code": 401, "msg": "未授权访问", "data": null }
          }
        }
      },
      "NotFound": {
        "description": "资源不存在",
        "content": {
          "application/json": {
            "example": { "code": 404, "msg": "资源不存在", "data": null }
          }
        }
      },
      "ValidationError": {
        "description": "数据校验失败",
        "content": {
          "application/json": {
            "example": { "code": 422, "msg": "数据校验失败", "data": { "errors": { "name": ["权限名称不能为空"] } } }
          }
        }
      }
    }
  }
}
